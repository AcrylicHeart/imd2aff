# 节奏大师(imd)转Arcaea(aff)

生成的aff适用于arc4.0以后,2024年愚人节之前的版本。

本代码使用4.0以后出现的3号蛇来表示节奏大师中的折线，在节奏大师中，对于时间长度小于33ms的hold，统一转换成了arc的singlearctap。

## 使用方法

在工作目录中创建两个文件夹：`input` 和 `output`。

在`input`中放入要转换的imd，imd的文件名称格式要符合以下习惯：

```
样例
woaini_4k_hd.imd
woaini_5k_ez.imd
woaini_6k_nm.imd
```

运行py代码后会在`output`文件夹中生成对应的aff。

## imd格式解析

本部分为个人观察少量imd得出的结论，如有疏漏请见谅。

imd文件以二进制的形式存储，imd大致分为3个部分。

### 曲子信息

曲子信息部分位于imd文件中的第1到第16个字节。

第1-4字节表示的是曲子时间长度，转换成10进制后，单位为ms。

第5-8字节表示的是曲子的小节数。

第9-16字节暂时未知。

### 小节部分

小节部分从第17个字节开始，长度为 `小节数 * 12 - 2`。

小节大部分由12个字节组成，前4个字节暂时未知，后8个字节表示小节线所在时间，单位为ms。

最后一组小节线长度仅为10。

### 物件部分

小节部分结束后，后面的部分都为物件部分。

每个物件由11个字节组成。

其中，第1位字节用于表示物件类型

```
00:note
01:flick
02:hold
21:折线 持续 flick
22:折线 持续 hold
61:折线 开始 flick
62:折线 开始 hold
A1:折线 结束 flick
A2:折线 结束 hold
```

第2位暂时未知。

第3-6位字节表示物件所在时间，单位为ms。

第7位表示物件所在轨道。

第8-11位字节，

对于note，暂时不知道有什么作用；

对于flick，表示滑动的宽度，数据类型为带符号整型；

对于hold，表示持续时间。
